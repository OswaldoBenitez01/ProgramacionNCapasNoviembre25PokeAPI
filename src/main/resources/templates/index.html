<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Pokédex Retro</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

        <style>
            @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

            * {
                box-sizing: border-box;
            }

            body {
                background: linear-gradient(135deg,
                    #0f0f23 0%,
                    #1a1a2e 50%,
                    #16213e 100%);
                min-height: 100vh;
                font-family: 'Press Start 2P', monospace;
                color: #fff;
                padding: 20px;
                margin: 0;
            }

            .pokedex-header {
                text-align: center;
                margin-bottom: 40px;
            }

            .pokedex-title {
                font-size: clamp(1.5rem, 4vw, 2.5rem);
                margin: 0;
                text-shadow: 2px 2px 0px #000;
                letter-spacing: 2px;
            }

            .pokedex-subtitle {
                font-size: 0.6rem;
                color: #ccc;
                margin-top: 8px;
                letter-spacing: 1px;
            }

            .pokemon-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
                gap: 24px;
                justify-content: center;
                max-width: 1400px;
                margin: 0 auto 40px auto;
            }

            .card-container {
                perspective: 1200px;
                height: 320px;
            }

            .poke-card {
                position: relative;
                width: 100%;
                height: 100%;
                transform-style: preserve-3d;
                transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            }

            .card-container.flipped .poke-card {
                transform: rotateY(180deg);
            }

            .card-face {
                position: absolute;
                width: 100%;
                height: 100%;
                backface-visibility: hidden;
                border-radius: 16px;
                border: 3px solid #333;
                box-shadow:
                    0 8px 16px rgba(0,0,0,0.6),
                    inset 0 2px 4px rgba(255,255,255,0.1);
                padding: 16px;
                display: flex;
                flex-direction: column;
                cursor: pointer;
            }

            .card-front {
                /* COLOR DINÁMICO POR TIPO */
            }

            .card-back {
                transform: rotateY(180deg);
                background: linear-gradient(145deg, #1a1a2e, #16213e);
            }

            .card-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 12px;
            }

            .pokemon-name {
                font-size: 0.85rem;
                font-weight: bold;
                text-transform: uppercase;
                letter-spacing: 1px;
                text-shadow: 1px 1px 0px rgba(0,0,0,0.8);
            }

            .pokemon-id {
                background: rgba(0,0,0,0.6);
                color: #fff;
                padding: 4px 8px;
                border-radius: 8px;
                font-size: 0.65rem;
            }

            .pokemon-sprite {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .pokemon-sprite img {
                width: 96px;
                height: 96px;
                image-rendering: pixelated;
                filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.8));
            }

            .pokemon-types {
                display: flex;
                gap: 6px;
                justify-content: center;
                flex-wrap: wrap;
            }

            .type-badge {
                background: rgba(255,255,255,0.2);
                border: 1px solid rgba(255,255,255,0.4);
                padding: 4px 8px;
                border-radius: 8px;
                font-size: 0.6rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .back-content {
                display: flex;
                flex-direction: column;
                height: 100%;
                justify-content: space-between;
            }

            .back-stats {
                font-size: 0.55rem;
                line-height: 1.3;
            }

            .back-stats p {
                margin: 2px 0;
            }

            .detail-btn {
                background: linear-gradient(145deg, #ff6b6b, #ee5a52);
                border: 2px solid #fff;
                color: #fff;
                padding: 8px 16px;
                border-radius: 12px;
                font-size: 0.7rem;
                font-weight: bold;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                text-decoration: none;
                transition: all 0.2s ease;
                box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            }

            .detail-btn:hover {
                background: linear-gradient(145deg, #ee5a52, #ff6b6b);
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(0,0,0,0.4);
                color: #fff;
            }

            .pagination-container {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 12px;
                flex-wrap: wrap;
                margin-top: 40px;
            }

            .page-btn {
                background: linear-gradient(145deg, #2a2a4a, #1a1a2e);
                border: 2px solid #444;
                color: #fff;
                padding: 10px 16px;
                border-radius: 12px;
                font-size: 0.75rem;
                font-weight: bold;
                text-transform: uppercase;
                letter-spacing: 1px;
                text-decoration: none;
                transition: all 0.2s ease;
                box-shadow: 0 4px 8px rgba(0,0,0,0.4);
            }

            .page-btn:hover:not(:disabled) {
                background: linear-gradient(145deg, #3a3a6a, #2a2a4a);
                border-color: #666;
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(0,0,0,0.5);
                color: #fff;
            }

            .page-btn:disabled {
                opacity: 0.4;
                cursor: not-allowed;
            }

            .page-info {
                background: linear-gradient(145deg, #1a1a2e, #16213e);
                border: 2px solid #444;
                color: #fff;
                padding: 10px 16px;
                border-radius: 12px;
                font-size: 0.8rem;
                font-weight: bold;
            }

            .page-jump input {
                width: 70px;
                height: 42px;
                border: 2px solid #444;
                border-radius: 12px;
                background: #1a1a2e;
                color: #fff;
                text-align: center;
                font-family: 'Press Start 2P', monospace;
                font-size: 0.7rem;
            }

            .page-jump input::placeholder {
                color: #666;
            }

            .page-jump button {
                height: 42px;
                padding: 0 12px;
                border-radius: 12px;
                background: linear-gradient(145deg, #ff6b6b, #ee5a52);
                border: 2px solid #fff;
                color: #fff;
                font-weight: bold;
                font-size: 0.7rem;
            }

            @media (max-width: 768px) {
                .pokemon-grid {
                    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                    gap: 16px;
                }
            }
        </style>
    </head>
    <body>

        <div class="container">
            <div class="pokedex-header">
                <h1 class="pokedex-title">POKÉDEX</h1>
                <p class="pokedex-subtitle">Haz click en las cartas para darles vuelta</p>
            </div>

            <!-- Error -->
            <div th:if="${result.Correct == false}" 
                 class="alert alert-danger text-center mb-4">
                <span th:text="${result.ErrorMessage}"></span>
            </div>

            <!-- Grid -->
            <div th:if="${result.Correct == true}" class="pokemon-grid">
                <div class="card-container" 
                     th:each="pokemon : ${result.Objects}"
                     onclick="this.classList.toggle('flipped')">

                    <div class="poke-card">

                        <!-- FRENTE -->
                        <div class="card-face card-front"
                             th:style="'background: ' + ${@pokeApiController.obtenerTipo(pokemon)}">

                            <div class="card-header">
                                <div class="pokemon-name" th:text="${pokemon.name}"></div>
                                <div class="pokemon-id"
                                     th:text="'#' + ${#numbers.formatInteger(pokemon.id, 3)}"></div>
                            </div>

                            <div class="pokemon-sprite">
                                <img th:if="${pokemon.sprites != null}"
                                     th:src="${pokemon.sprites.frontDefault}"
                                     th:alt="${pokemon.name}">
                            </div>

                            <div class="pokemon-types">
                                <span class="type-badge"
                                      th:each="t : ${pokemon.types}"
                                      th:text="${t.type.name}"></span>
                            </div>

                        </div>

                        <!-- TRASERO -->
                        <div class="card-face card-back">
                            <div class="back-content">
                                <div class="back-stats">
                                    <p>Altura: <span th:text="${pokemon.height}"></span> dm</p>
                                    <p>Peso: <span th:text="${pokemon.weight}"></span> hg</p>
                                    <p>Base EXP: <span th:text="${pokemon.baseExperience}"></span></p>
                                </div>

                                <a class="detail-btn"
                                   th:href="@{/pokemon/{name}(name=${pokemon.name})}">
                                    VER DETALLE →
                                </a>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- PAGINACIÓN -->
            <div class="pagination-container" th:if="${result.Correct == true}">
                <a class="page-btn"
                   th:if="${currentOffset > 0}"
                   th:href="@{/pokemon(limit=${limit}, offset=${currentOffset - limit})}">
                    ← Anterior
                </a>

                <span class="page-info">
                    Página <span th:text="${currentOffset / limit + 1}"></span>
                </span>

                <a class="page-btn"
                   th:href="@{/pokemon(limit=${limit}, offset=${currentOffset + limit})}">
                    Siguiente →
                </a>

                <form class="page-jump" th:action="@{/pokemon}" method="get">
                    <input type="hidden" name="limit" th:value="${limit}"/>
                    <input type="number" 
                           name="page" 
                           min="1"
                           th:value="${currentOffset / limit + 1}"
                           placeholder="Página"/>
                    <button type="submit">Ir</button>
                </form>
            </div>
        </div>
        
        <button id="miBotón">Reproducir Sonido</button>
        <audio id="miAudio" src="https://raw.githubusercontent.com/PokeAPI/cries/main/cries/pokemon/latest/1.ogg"></audio>
        
        <script>
            document.getElementById('miBotón').addEventListener('click', function() {
              var audio = document.getElementById('miAudio');
              audio.play();
            });
        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

        <!-- paginación -->
        <script th:inline="javascript">
                         document.querySelectorAll('form[action$="/pokemon"]').forEach(form => {
                             form.addEventListener('submit', function (e) {
                                 const pageInput = this.querySelector('input[name="page"]');
                                 const limitInput = this.querySelector('input[name="limit"]');

                                 if (pageInput && limitInput) {
                                     const page = parseInt(pageInput.value) || 1;
                                     const limit = parseInt(limitInput.value) || 12;
                                     const offset = (page - 1) * limit;

                                     const offsetInput = document.createElement('input');
                                     offsetInput.type = 'hidden';
                                     offsetInput.name = 'offset';
                                     offsetInput.value = offset;
                                     this.appendChild(offsetInput);
                                 }
                             });
                         });
        </script>

    </body>
</html>
