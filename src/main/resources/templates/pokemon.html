<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Información del Pokémon</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.min.css">
        <style>
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            body {
                font-family: 'Press Start 2P', monospace;
                background-color: #1b1b2f;
                background-image:
                    linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
                background-size: 40px 40px;
                min-height: 100vh;
                padding: 30px 20px;
                color: #fff;
            }

        </style>

    </head>


    <body>

        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-12 col-md-8 col-lg-5">

                    <div class="card shadow border-0 overflow-hidden" style="border-radius: 1.5rem;">

                        <div class="card-header text-white text-center py-4" th:style="'background: ' + ${Color}">
                            <div class="d-flex justify-content-between px-3 text-white-50 small fw-bold">
                                <a href="http://localhost:8080/pokemon" style="color: white;">POKÉDEX</a >
                                <span th:text="'#' + ${pokemon.id}">#25</span>
                            </div>
                            <h2 class="text-white text-capitalize mb-0 mt-2 display-6 fw-bold" th:text="${pokemon.name}">Nombre</h2>
                        </div>

                        <div class="card-body bg-white text-center pt-0">

                            <div class="bg-white rounded-circle d-inline-block shadow-sm p-3" 
                                 style="margin-top: -10px; width: 150px; height: 150px; border: 5px solid black;">
                                <img id="pokemonImg" 
                                     th:src="${pokemon.sprites.frontDefault}" 
                                     class="img-fluid" 
                                     style="cursor: pointer; transform: scale(1.2);"
                                     onclick="cambiarSprite()">
                            </div>

                            <div class="d-flex justify-content-center gap-4 my-3">
                                <i id="iconoShiny" class="bi bi-stars" 
                                   onclick="toggleShiny()" 
                                   style="cursor:pointer; font-size: 1.5rem;" 
                                   title="Modo Shiny"></i>

                                <i id="iconoGenero" class="bi bi-gender-male fs-3" onclick="toggleGenero()" style="cursor:pointer; color: #0d6efd;" title="Género"></i>
                                <i id="iconoSonido" class="bi bi-volume-up-fill fs-3 text-secondary" onclick="Sonido()" style="cursor:pointer;" title="Sonido"></i>
                            </div>

                            <div class="mb-4">
                                <span th:each="type, iterStat : ${pokemon.types}"
                                      th:text="${type.type.name}"
                                      th:style="'background-color: ' + ${coloresTipos[iterStat.index]}"
                                      class="badge rounded-pill text-white px-3 py-2 text-capitalize mx-1 shadow-sm">
                                </span>
                            </div>

                            <div class="row g-0 py-2 bg-light rounded-4 mb-4">
                                <div class="col-4 border-end">
                                    <small class="text-muted d-block">Peso</small>
                                    <span class="fw-bold" th:text="${pokemon.weight / 10.0} + ' kg'">6 kg</span>
                                </div>
                                <div class="col-4 border-end">
                                    <small class="text-muted d-block">Altura</small>
                                    <span class="fw-bold" th:text="${pokemon.height / 10.0} + ' m'">0.4 m</span>
                                </div>
                                <div class="col-4">
                                    <small class="text-muted d-block">Base Exp</small>
                                    <span class="fw-bold" th:text="${pokemon.baseExperience}">112</span>
                                </div>
                            </div>

                            <div class="text-start mb-4 px-2">
                                <h6 class="fw-bold text-secondary mb-3 small"><i class="bi bi-bar-chart-fill"></i> ESTADÍSTICAS BASE</h6>
                                <div th:each="stat : ${pokemon.stats}" class="row align-items-center mb-2">
                                    <div class="col-4 text-capitalize small fw-bold text-muted" th:text="${stat.stat.name}">hp</div>
                                    <div class="col-6 p-0">
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar rounded-pill" 
                                                 th:style="'width: ' + (${stat.baseStat} * 100 / 200) + '%; background-color: ' + ${Color}"
                                                 th:aria-valuenow="${stat.baseStat}" aria-valuemin="0" aria-valuemax="255"></div>
                                        </div>
                                    </div>
                                    <div class="col-2 text-end small fw-bold" th:text="${stat.baseStat}">50</div>
                                </div>
                            </div>

                            <div class="row text-start g-3 px-2">
                                <div class="col-6">
                                    <h6 class="fw-bold text-secondary small text-uppercase">Habilidades</h6>
                                    <div class="d-flex flex-wrap gap-1">
                                        <span th:each="ability : ${pokemon.abilities}" 
                                              th:text="${ability.ability.name}"
                                              class="badge bg-light text-dark border fw-normal text-capitalize w-100 py-2">
                                        </span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <h6 class="fw-bold text-secondary small text-uppercase">Movimientos</h6>
                                    <div class="overflow-auto border rounded-3 p-2 bg-light" style="max-height: 80px;">
                                        <span th:each="move : ${pokemon.moves}" 
                                              th:text="${move.move.name}"
                                              class="d-block small text-capitalize mb-1 border-bottom pb-1">
                                        </span>
                                    </div>
                                </div>
                            </div>

                        </div> </div> </div> </div> </div> </body>


    <script th:inline="javascript">

        //sonido del pokemon
        const audio = /*[[${pokemon.cries.latest}]]*/ ''
        const pokemonAudio = new Audio(audio);
        function Sonido() {
            pokemonAudio.currentTime = 0;
            pokemonAudio.play().catch(error => {
                console.error("Error al reproducir el audio:", error);
            });

        }

        // Esto es para tener los sprites del pokemon en shiny o normal,de espalda, de frente y es hembra o macho
        const sprites = {
            front: /*[[${pokemon.sprites.frontDefault}]]*/ '',
            back: /*[[${pokemon.sprites.backDefault}]]*/ '',
            frontShiny: /*[[${pokemon.sprites.frontShiny}]]*/ '',
            backShiny: /*[[${pokemon.sprites.backShiny}]]*/ '',
            frontFem: /*[[${pokemon.sprites.frontFemale}]]*/ '',
            backFem: /*[[${pokemon.sprites.backFemale}]]*/ '',
            frontShinyFem: /*[[${pokemon.sprites.frontShinyFemale}]]*/ '',
            backShinyFem: /*[[${pokemon.sprites.backShinyFemale}]]*/ ''
        };

        let esShiny = false;
        let mostrandoFront = true;
        let esFemenino = false;

        // Función para ocultar el icono de género si no hay sprites femeninos
        function checkGeneroHabilitado() {
            const iconoG = document.getElementById('iconoGenero');
            if (!sprites.frontFem) {
                iconoG.style.display = 'none';
            }
        }

        function actualizarImagen() {
            const img = document.getElementById('pokemonImg');
            let seleccionada = '';

            if (esFemenino && sprites.frontFem) {
                // Lógica Femenina
                if (esShiny && sprites.frontShinyFem) {
                    seleccionada = mostrandoFront ? sprites.frontShinyFem : (sprites.backShinyFem || sprites.frontShinyFem);
                } else {
                    seleccionada = mostrandoFront ? sprites.frontFem : (sprites.backFem || sprites.frontFem);
                }
            } else {
                // Lógica Masculina / Default
                if (esShiny) {
                    seleccionada = mostrandoFront ? sprites.frontShiny : (sprites.backShiny || sprites.frontShiny);
                } else {
                    seleccionada = mostrandoFront ? sprites.front : (sprites.back || sprites.front);
                }
            }

            if (seleccionada)
                img.src = seleccionada;
        }

        // Esta es la funcion para que el pokemon se de vuelta
        function cambiarSprite() {
            mostrandoFront = !mostrandoFront;
            actualizarImagen();
        }

        //Esta funcion es para hacer que sea shiny o regrese al normal y cambia el diesño del botom
        function toggleShiny() {
            if (esShiny || sprites.frontShiny) { // Verificar si existe versión shiny
                esShiny = !esShiny;
                actualizarImagen();
                const icono = document.getElementById('iconoShiny');
                icono.style.color = esShiny ? '#f1c40f' : 'inherit';
            }
        }

        function toggleGenero() {
            if (sprites.frontFem) {
                esFemenino = !esFemenino;
                actualizarImagen();

                const icono = document.getElementById('iconoGenero');
                if (esFemenino) {
                    icono.className = 'bi bi-gender-female';
                    icono.style.color = '#e84393';
                } else {
                    icono.className = 'bi bi-gender-male';
                    icono.style.color = '#3498db';
                }
            }
        }

        // Ejecutar al cargar
        checkGeneroHabilitado();
    </script>

</html>
