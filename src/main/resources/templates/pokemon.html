<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Información del Pokémon</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.min.css">
    </head>

    <body class="bg-light">

        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-md-6">

                    <div class="card shadow-lg">

                        <!-- Header -->
                        <div class="card-header text-white text-center"
                             th:style="'background: ' + ${Color}">
                            <h3 class="mb-0 text-capitalize" th:text="${pokemon.name}">Nombre</h3>
                            <small>#<span th:text="${pokemon.id}">25</span></small>
                        </div>

                        <!-- Imagen -->
                        <div class="text-center p-3">
                            <img id="pokemonImg"
                                 th:src="${pokemon.sprites.frontDefault}"
                                 class="img-fluid"
                                 style="max-height:150px; cursor:pointer;"
                                 onclick="cambiarSprite()">

                            <br> <i id="iconoShiny" class="bi bi-stars" 
                                    onclick="toggleShiny()" 
                                    style="cursor:pointer; font-size: 1.5rem;" 
                                    title="Modo Shiny"></i>

                            <i id="iconoGenero" class="bi bi-gender-male" 
                               onclick="toggleGenero()" 
                               style="cursor:pointer; font-size: 1.5rem; color: #3498db;" 
                               title="Cambiar Género"></i>

                            <i id="iconoSonido" class="bi bi-volume-up-fill" 
                               onclick="Sonido()" 
                               style="cursor:pointer; font-size: 1.5rem; color: #3498db;" 
                               title="Escuchar sonido"></i>
                        </div>

                        <!-- Información -->
                        <ul class="list-group list-group-flush">

                            <li class="list-group-item d-flex justify-content-between">
                                <span><i class="bi bi-lightning-charge text-warning"></i> Experiencia</span>
                                <strong th:text="${pokemon.baseExperience}">112</strong>
                            </li>

                            <li class="list-group-item d-flex justify-content-between">
                                <span><i class="bi bi-arrows-vertical"></i> Altura</span>
                                <strong th:text="${pokemon.height}">4</strong>
                            </li>

                            <li class="list-group-item d-flex justify-content-between">
                                <span><i class="bi bi-speedometer2"></i> Peso</span>
                                <strong th:text="${pokemon.weight}">60</strong>
                            </li>

                            <!-- Tipos -->
                            <li class="list-group-item">
                                <strong>Tipos:</strong>
                                <div class="mt-2">
                                    <span class="badge me-1 text-capitalize text-white"
                                          th:each="type, iterStat : ${pokemon.types}"
                                          th:text="${type.type.name}"
                                          th:style="'background: ' + ${coloresTipos[iterStat.index]}">
                                    </span>
                                </div>
                            </li>

                            <!-- Habilidades -->
                            <li class="list-group-item">
                                <strong>Habilidades:</strong>
                                <ul class="mb-0 mt-2">
                                    <li th:each="ability : ${pokemon.abilities}"
                                        th:text="${ability.ability.name}"
                                        class="text-capitalize">
                                        static
                                    </li>
                                </ul>
                            </li>                                                        

                        </ul>

                    </div>

                </div>
            </div>
        </div>

    </body>


    <script th:inline="javascript">

        const audio = /*[[${pokemon.cries.latest}]]*/ ''
        const pokemonAudio = new Audio(audio);
        function Sonido() {
            pokemonAudio.currentTime = 0;
            pokemonAudio.play().catch(error => {
                console.error("Error al reproducir el audio:", error);
            });

        }

        // Esto es para tener los sprites del pokemon en shiny o normal,de espalda, de frente y es hembra o macho
        const sprites = {
            front: /*[[${pokemon.sprites.frontDefault}]]*/ '',
            back: /*[[${pokemon.sprites.backDefault}]]*/ '',
            frontShiny: /*[[${pokemon.sprites.frontShiny}]]*/ '',
            backShiny: /*[[${pokemon.sprites.backShiny}]]*/ '',
            frontFem: /*[[${pokemon.sprites.frontFemale}]]*/ '',
            backFem: /*[[${pokemon.sprites.backFemale}]]*/ '',
            frontShinyFem: /*[[${pokemon.sprites.frontShinyFemale}]]*/ '',
            backShinyFem: /*[[${pokemon.sprites.backShinyFemale}]]*/ ''
        };

        let esShiny = false;
        let mostrandoFront = true;
        let esFemenino = false;

        // Función para ocultar el icono de género si no hay sprites femeninos
        function checkGeneroHabilitado() {
            const iconoG = document.getElementById('iconoGenero');
            if (!sprites.frontFem) {
                iconoG.style.display = 'none';
            }
        }

        function actualizarImagen() {
            const img = document.getElementById('pokemonImg');
            let seleccionada = '';

            if (esFemenino && sprites.frontFem) {
                // Lógica Femenina
                if (esShiny && sprites.frontShinyFem) {
                    seleccionada = mostrandoFront ? sprites.frontShinyFem : (sprites.backShinyFem || sprites.frontShinyFem);
                } else {
                    seleccionada = mostrandoFront ? sprites.frontFem : (sprites.backFem || sprites.frontFem);
                }
            } else {
                // Lógica Masculina / Default
                if (esShiny) {
                    seleccionada = mostrandoFront ? sprites.frontShiny : (sprites.backShiny || sprites.frontShiny);
                } else {
                    seleccionada = mostrandoFront ? sprites.front : (sprites.back || sprites.front);
                }
            }

            if (seleccionada)
                img.src = seleccionada;
        }

        // Esta es la funcion para que el pokemon se de vuelta
        function cambiarSprite() {
            mostrandoFront = !mostrandoFront;
            actualizarImagen();
        }

        //Esta funcion es para hacer que sea shiny o regrese al normal y cambia el diesño del botom
        function toggleShiny() {
            if (esShiny || sprites.frontShiny) { // Verificar si existe versión shiny
                esShiny = !esShiny;
                actualizarImagen();
                const icono = document.getElementById('iconoShiny');
                icono.style.color = esShiny ? '#f1c40f' : 'inherit';
            }
        }

        function toggleGenero() {
            if (sprites.frontFem) {
                esFemenino = !esFemenino;
                actualizarImagen();

                const icono = document.getElementById('iconoGenero');
                if (esFemenino) {
                    icono.className = 'bi bi-gender-female';
                    icono.style.color = '#e84393'; // Rosado
                } else {
                    icono.className = 'bi bi-gender-male';
                    icono.style.color = '#3498db'; // Azul
                }
            }
        }

        // Ejecutar al cargar
        checkGeneroHabilitado();
    </script>

</html>
